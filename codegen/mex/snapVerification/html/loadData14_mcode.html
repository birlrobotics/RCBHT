<pre class="code">
<span class="srcline"><span class="lineno"><a href="6,1" id="srcline1"> 1</a></span><span class="line"><span class="comment">% Load Data</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">% Function modified last: Nov. 26, 2012</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% To prepare for codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Arguments removed. Codegen does not support strcat, ispc, </span></span></span>
<span class="srcline"><span class="lineno"><a href="6,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% Solution: </span></span></span>
<span class="srcline"><span class="lineno"><a href="6,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   Assign a hardcoded folder for results to come in.</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%       If simulation select your folder of choice.</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,10" id="srcline10">10</a></span><span class="line"><span class="comment">%       If Hiro robot select: \\home\\grxuser\\src\\OpenHRP3-0\\Controller\\IOserver\\HRP2STEP1\\bin)</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,11" id="srcline11">11</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,12" id="srcline12">12</a></span><span class="line"><span class="comment">% CodeGen does not recognize:</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,13" id="srcline13">13</a></span><span class="line"><span class="comment">% strcat commands</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,14" id="srcline14">14</a></span><span class="line"><span class="comment">% if(ispc) remove</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,15" id="srcline15">15</a></span><span class="line"><span class="comment">%--------------------------------------------------------------------------</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,16" id="srcline16">16</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">AD</span>,<span class="var type1" id="S3T40U4">FD</span>,<span class="var type1" id="S4T1U5">CP</span>,<span class="var type1" id="S5T41U6">SD</span>] = loadData(<span class="var type1" id="S6T11U9">fPath</span>,<span class="var type1" id="S7T3U10">StratTypeFolder</span>,<span class="var type1" id="S8T3U11">FolderName</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="6,17" id="srcline17">17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="6,18" id="srcline18">18</a></span><span class="line">    <span class="comment">%% Global Functions</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,19" id="srcline19">19</a></span><span class="line">    <span class="keyword">global</span> <span class="var type2" id="S9T0U13">DB_DEBUG</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="6,20" id="srcline20">20</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="6,21" id="srcline21">21</a></span><span class="line">    <span class="comment">% If manually loading adjust here and comment out later</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,22" id="srcline22">22</a></span><span class="line">    <span class="comment">%AngleData       ='/home/grxuser/Documents/School/Research/AIST/Results/ForceControl/ErrorCharac/Angles.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,23" id="srcline23">23</a></span><span class="line">    <span class="comment">%ForceData       ='/home/grxuser/Documents/School/Research/AIST/Results/ForceControl/ErrorCharac/Torques.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,24" id="srcline24">24</a></span><span class="line">    <span class="comment">%CartPos         ='/home/grxuser/Documents/School/Research/AIST/Results/ForceControl/ErrorCharac/CartPos.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,25" id="srcline25">25</a></span><span class="line">    <span class="comment">%StateData       ='/home/grxuser/Documents/School/Research/AIST/Results/ForceControl/ErrorCharac/State.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,26" id="srcline26">26</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="6,27" id="srcline27">27</a></span><span class="line">    <span class="comment">% If running HIRO Online Experiments use:</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,28" id="srcline28">28</a></span><span class="line">    <span class="comment">%AngleData       ='\\home\\grxuser\\src\\OpenHRP3-0\\Controller\\IOserver\\HRP2STEP1\\bin\\Angles.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,29" id="srcline29">29</a></span><span class="line">    <span class="comment">%ForceData       ='\\home\\grxuser\\src\\OpenHRP3-0\\Controller\\IOserver\\HRP2STEP1\\bin\\Torques.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,30" id="srcline30">30</a></span><span class="line">    <span class="comment">%CartPos         ='\\home\\grxuser\\src\\OpenHRP3-0\\Controller\\IOserver\\HRP2STEP1\\bin\CartPos.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,31" id="srcline31">31</a></span><span class="line">    <span class="comment">%StateData       ='\\home\\grxuser\\src\\OpenHRP3-0\\Controller\\IOserver\\HRP2STEP1\\bin\\State.dat';</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="6,33" id="srcline33">33</a></span><span class="line">    <span class="comment">%% Init</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,34" id="srcline34">34</a></span><span class="line">    <span class="mxinfo" id="T1:U8"><span class="var type1" id="S10T1U16">jointAnglesFlag</span> = <span class="mxinfo" id="T1:U10">0</span></span>;    <span class="comment">% If we want to load these data, set flag to true</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,35" id="srcline35">35</a></span><span class="line">    <span class="mxinfo" id="T1:U11"><span class="var type1" id="S11T1U20">cartPosFlag</span> = <span class="mxinfo" id="T1:U13">0</span></span>;        </span></span>
<span class="srcline"><span class="lineno"><a href="6,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="6,37" id="srcline37">37</a></span><span class="line">    <span class="comment">%% Assign the right folder name</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,38" id="srcline38">38</a></span><span class="line">    <span class="var type0" id="S12T0U24">ForceData</span>       =<span class="message error" id="M10F14C">strcat(<span class="var type1" id="S6T11U27">fPath</span>,<span class="var type1" id="S7T3U28">StratTypeFolder</span>,<span class="var type1" id="S8T3U29">FolderName</span>,<span class="mxinfo" id="T42:U17"><span class="string">'/Torques.dat'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="6,39" id="srcline39">39</a></span><span class="line">    <span class="var type0" id="S14T0U33">StateData</span>       =<span class="message error" id="M11F14C">strcat(<span class="var type1" id="S6T11U36">fPath</span>,<span class="var type1" id="S7T3U37">StratTypeFolder</span>,<span class="var type1" id="S8T3U38">FolderName</span>,<span class="mxinfo" id="T43:U21"><span class="string">'/State.dat'</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="6,40" id="srcline40">40</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type1" id="S10T1U44">jointAnglesFlag</span> &amp;&amp; <span class="var type2" id="S11T0U45">cartPosFlag</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="6,41" id="srcline41">41</a></span><span class="line">        <span class="var type0" id="S15T0U48">AngleData</span>   =strcat(<span class="var type2" id="S6T0U51">fPath</span>,<span class="var type2" id="S7T0U52">StratTypeFolder</span>,<span class="var type2" id="S8T0U53">FolderName</span>,<span class="string">'/Angles.dat'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="6,42" id="srcline42">42</a></span><span class="line">        <span class="var type0" id="S16T0U57">CartPos</span>     =strcat(<span class="var type2" id="S6T0U60">fPath</span>,<span class="var type2" id="S7T0U61">StratTypeFolder</span>,<span class="var type2" id="S8T0U62">FolderName</span>,<span class="string">'/CartPos.dat'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="6,43" id="srcline43">43</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,44" id="srcline44">44</a></span><span class="line">        <span class="mxinfo" id="T1:U23"><span class="var type1" id="S2T1U67">AD</span>=<span class="mxinfo" id="T1:U25">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="6,45" id="srcline45">45</a></span><span class="line">        <span class="mxinfo" id="T1:U26"><span class="var type1" id="S4T1U71">CP</span>=<span class="mxinfo" id="T1:U28">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="6,46" id="srcline46">46</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,47" id="srcline47">47</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="6,48" id="srcline48">48</a></span><span class="line">    <span class="comment">%% Load the data</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,49" id="srcline49">49</a></span><span class="line">    <span class="var type2" id="S3T0U75">FD</span>=load(<span class="var type0" id="S12T0U78"><span class="message error" id="M12F14C">ForceData</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="6,50" id="srcline50">50</a></span><span class="line">    <span class="var type2" id="S5T0U81">SD</span>=load(<span class="var type0" id="S14T0U84"><span class="message error" id="M13F14C">StateData</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="6,51" id="srcline51">51</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type1" id="S10T1U89">jointAnglesFlag</span> &amp;&amp; <span class="var type2" id="S11T0U90">cartPosFlag</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="6,52" id="srcline52">52</a></span><span class="line">        <span class="var type2" id="S2T0U93">AD</span>=load(<span class="var type0" id="S15T0U96">AngleData</span>);       </span></span>
<span class="srcline"><span class="lineno"><a href="6,53" id="srcline53">53</a></span><span class="line">        <span class="var type2" id="S4T0U99">CP</span>=load(<span class="var type0" id="S16T0U102">CartPos</span>);     </span></span>
<span class="srcline"><span class="lineno"><a href="6,54" id="srcline54">54</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,55" id="srcline55">55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="6,56" id="srcline56">56</a></span><span class="line">    <span class="comment">% Adjust the data length so that it finishes when mating is finished. </span></span></span>
<span class="srcline"><span class="lineno"><a href="6,57" id="srcline57">57</a></span><span class="line">    [<span class="var type0" id="S18T0U106"><span class="message error" id="M15F14C">rSD</span></span>,<span class="mxinfo" id="T1:U30"><span class="mxinfo" id="T1:U31"><span class="message error" id="M16F14C">~</span></span></span>] = size(<span class="var type2" id="S5T0U110"><span class="message error" id="M14F14C">SD</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="6,58" id="srcline58">58</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type0" id="S18T0U115"><span class="message error" id="M17F14C">rSD</span></span>==5)</span></span>
<span class="srcline"><span class="lineno"><a href="6,59" id="srcline59">59</a></span><span class="line">        <span class="var type0" id="S20T0U119">endTime</span> = <span class="var type2" id="S5T0U121"><span class="message error" id="M18F14C">SD</span></span>(5,1);</span></span>
<span class="srcline"><span class="lineno"><a href="6,60" id="srcline60">60</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="6,61" id="srcline61">61</a></span><span class="line">        <span class="comment">% There are 2 cases to check: (1) If state endTime is less than actual data, and if it is more.  </span></span></span>
<span class="srcline"><span class="lineno"><a href="6,62" id="srcline62">62</a></span><span class="line">        <span class="keyword">if</span>(<span class="var type2" id="S3T0U129"><span class="message error" id="M19F14C">FD</span></span>(end,1)&gt;<span class="var type0" id="S20T0U133">endTime</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="6,63" id="srcline63">63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="6,64" id="srcline64">64</a></span><span class="line">            <span class="comment">% Note that SD(5,1) is hardcoded as some time k later thatn SD(4,1). </span></span></span>
<span class="srcline"><span class="lineno"><a href="6,65" id="srcline65">65</a></span><span class="line">            <span class="var type0" id="S20T0U136">endTime</span> = floor(<span class="var type0" id="S20T0U141"><span class="message error" id="M20F14C">endTime</span></span>/0.005)+1; <span class="comment">% The Angles/Torques data is comprised of steps of magnitude 0.0005. Then we round down.</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,66" id="srcline66">66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="6,67" id="srcline67">67</a></span><span class="line">            <span class="comment">% Time will be from 1:to the entry denoted by the State Vector in it's 5th entry. </span></span></span>
<span class="srcline"><span class="lineno"><a href="6,68" id="srcline68">68</a></span><span class="line">            <span class="var type2" id="S3T0U146">FD</span> = <span class="var type2" id="S3T0U148"><span class="message error" id="M21F14C">FD</span></span>(1:<span class="var type0" id="S20T0U151">endTime</span>,:);</span></span>
<span class="srcline"><span class="lineno"><a href="6,69" id="srcline69">69</a></span><span class="line">            <span class="keyword">if</span>(<span class="var type1" id="S10T1U157">jointAnglesFlag</span> &amp;&amp; <span class="var type2" id="S11T0U158">cartPosFlag</span>)            </span></span>
<span class="srcline"><span class="lineno"><a href="6,70" id="srcline70">70</a></span><span class="line">                <span class="var type2" id="S2T0U161">AD</span> = <span class="var type2" id="S2T0U163">AD</span>(1:<span class="var type0" id="S20T0U166">endTime</span>,:);                </span></span>
<span class="srcline"><span class="lineno"><a href="6,71" id="srcline71">71</a></span><span class="line">                <span class="var type2" id="S4T0U170">CP</span> = <span class="var type2" id="S4T0U172">CP</span>(1:<span class="var type0" id="S20T0U175">endTime</span>,:);</span></span>
<span class="srcline"><span class="lineno"><a href="6,72" id="srcline72">72</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,73" id="srcline73">73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="6,74" id="srcline74">74</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,75" id="srcline75">75</a></span><span class="line">            <span class="var type2" id="S5T0U181">SD</span>(5,1) = <span class="var type2" id="S3T0U185"><span class="message error" id="M22F14C">FD</span></span>(end,1);</span></span>
<span class="srcline"><span class="lineno"><a href="6,76" id="srcline76">76</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,77" id="srcline77">77</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="6,78" id="srcline78">78</a></span><span class="line">    <span class="comment">%% Insert an end state for failed assemblies that have 4 entries</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,79" id="srcline79">79</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,80" id="srcline80">80</a></span><span class="line">        <span class="keyword">if</span>(<span class="var type0" id="S18T0U194"><span class="message error" id="M23F14C">rSD</span></span>&lt;5)</span></span>
<span class="srcline"><span class="lineno"><a href="6,81" id="srcline81">81</a></span><span class="line">            <span class="var type2" id="S5T0U199">SD</span>(<span class="var type0" id="S18T0U201">rSD</span>+1,1) = <span class="var type2" id="S3T0U205"><span class="message error" id="M24F14C">FD</span></span>(end,1);  <span class="comment">% Enter a new row in SD which includes the last time value contained in any of the other data vecs.</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,82" id="srcline82">82</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,83" id="srcline83">83</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="6,84" id="srcline84">84</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,85" id="srcline85">85</a></span><span class="line">    <span class="comment">%% Check to make sure that StateData has a finishing time included</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,86" id="srcline86">86</a></span><span class="line">    <span class="keyword">if</span>(<span class="var type1" id="S9T1U212">DB_DEBUG</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="6,87" id="srcline87">87</a></span><span class="line">        <span class="keyword">if</span>(<span class="mxinfo" id="T6:U34">strcmp(<span class="var type1" id="S7T3U219">StratTypeFolder</span>,<span class="string">'ForceControl/SideApproach/'</span>)</span> || <span class="mxinfo" id="T6:U36">strcmp(<span class="var type1" id="S7T3U223">StratTypeFolder</span>,<span class="string">'ForceControl/ErrorCharac/'</span>)</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="6,88" id="srcline88">88</a></span><span class="line">            <span class="keyword">if</span>(<span class="var type0" id="S18T0U229"><span class="message error" id="M25F14C">rSD</span></span>&lt;5)</span></span>
<span class="srcline"><span class="lineno"><a href="6,89" id="srcline89">89</a></span><span class="line">                fprintf(<span class="string">'StateData does not have 5 entries. You probably need to include the finishing time of the Assembly task in this vector.\n'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="6,90" id="srcline90">90</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,91" id="srcline91">91</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,92" id="srcline92">92</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="6,93" id="srcline93">93</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
